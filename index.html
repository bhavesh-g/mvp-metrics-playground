<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LLM Metric Playground</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
:root {
  --bg-primary:#0a0a0a;
  --bg-secondary:#1a1a1a;
  --bg-tertiary:#2a2a2a;
  --border:#3a3a3a;
  --text:#ffffff;
  --muted:#b0b0b0;
  --success:#44ff44;
  --error:#ff4444;
}
  .demo-disclaimer {
  background: rgba(255, 68, 68, 0.08);
  border-bottom: 1px solid rgba(255, 68, 68, 0.35);
  color: #ff8a8a;
  font-size: 0.85rem;
  text-align: center;
  padding: 0.6rem 1rem;
  position: sticky;
  top: 0;
  z-index: 2000;
}

body {
  background:var(--bg-primary);
  color:var(--text);
  font-family:Inter,sans-serif;
}

.header {
  background:var(--bg-secondary);
  border-bottom:1px solid var(--border);
}

.card {
  background:var(--bg-secondary);
  border:1px solid var(--border);
}

.form-control,.form-select {
  background:var(--bg-tertiary);
  color:var(--text);
  border:1px solid var(--border);
}

.metric-item {
  background:var(--bg-tertiary);
  border:1px solid var(--border);
  padding:1rem;
  margin-bottom:.75rem;
  cursor:pointer;
}

.metric-item:hover {
  border-color:#666;
}

.metric-actions {
  display:flex;
  gap:.5rem;
  margin-top:.5rem;
}

.alert {
  border-radius:6px;
}

.response-box {
  background:var(--bg-tertiary);
  border:1px solid var(--border);
  border-radius:6px;
  padding:.75rem;
  margin-bottom:.5rem;
  white-space:pre-wrap;
  word-break:break-word;
  font-family:monospace;
  font-size:.85rem;
}

.loader {
  display:inline-block;
  width:16px;
  height:16px;
  border:2px solid #666;
  border-top:2px solid #fff;
  border-radius:50%;
  animation:spin 1s linear infinite;
}

@keyframes spin {
  to { transform:rotate(360deg); }
}
</style>
</head>

<body>
<div class="demo-disclaimer">
  demo only. backend and llm calls run on a limited free tier. please avoid heavy or automated usage.
</div>
<header class="header py-4">
<div class="container">
<h2>LLM Metric Playground</h2>
<p class="text-secondary mt-2">
Define, version, and run custom evaluation metrics for real world LLM workflows.
Turn subjective quality into measurable signals you can regression test before shipping.
</p>
</div>
</header>

<div class="container py-4">

<div id="alertContainer"></div>

<ul class="nav nav-tabs mb-4">
<li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#metricsTab">Metrics</a></li>
<li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#createTab">Create Metric</a></li>
<li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#evaluateTab">Evaluate</a></li>
</ul>

<div class="tab-content">

<!-- METRICS -->
<div class="tab-pane fade show active" id="metricsTab">
<div class="mb-2 text-secondary">
Click a metric to view full details. Use edit to modify. Delete is irreversible.
</div>
<div id="metricsList"></div>
</div>

<!-- CREATE -->
<div class="tab-pane fade" id="createTab">
<div class="card"><div class="card-body">
<div class="text-secondary mb-2">
Use clear, stable names. Input fields become required evaluation inputs.
Output schema values must be primitive types.
</div>

<form id="createMetricForm">
<input type="hidden" id="editingMetric">

<div class="mb-2">
<label class="form-label">Metric Name</label>
<input class="form-control" id="metricName" required>
</div>

<div class="mb-2">
<label class="form-label">Description</label>
<input class="form-control" id="metricDescription">
</div>

<div class="mb-2">
<label class="form-label">Input Fields</label>
<div id="inputFieldsContainer"></div>
<button type="button" class="btn btn-sm btn-outline-secondary mt-1" onclick="addInputField()">Add field</button>
</div>

<div class="mb-2">
<label class="form-label">Prompt Template</label>
<textarea class="form-control" id="promptTemplate" rows="6" required></textarea>
</div>

<div class="mb-2">
<label class="form-label">Output Schema</label>
<div id="outputSchemaContainer"></div>
<button type="button" class="btn btn-sm btn-outline-secondary mt-1" onclick="addOutputField()">Add output</button>
</div>

<button class="btn btn-primary w-100 mt-3" id="saveMetricBtn">Save Metric</button>
</form>
</div></div>
</div>

<!-- EVALUATE -->
<div class="tab-pane fade" id="evaluateTab">
<div class="card"><div class="card-body">

<div class="text-secondary mb-2">
Fill all inputs. Empty values will fail validation.
</div>

<form id="evaluateForm">
<select id="evalMetricSelect" class="form-select mb-2" required></select>

<select id="evalProvider" class="form-select mb-2">
<option value="perplexity">perplexity</option>
<option value="openai">openai</option>
</select>

<input id="evalModel" class="form-control mb-2" value="sonar-pro">

<div id="evalInputsContainer"></div>

<button class="btn btn-primary w-100 mt-2" id="evaluateBtn">Evaluate</button>
</form>

<div id="evalResultContainer" class="mt-4" style="display:none">
<h6 class="text-secondary mb-2">Evaluation Result</h6>
<div id="evalResult"></div>
</div>

</div></div>
</div>

</div>
</div>

<!-- DETAILS MODAL -->
<div class="modal fade" id="metricModal" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content bg-dark border-secondary">
<div class="modal-header">
<h5 class="modal-title" id="metricModalTitle"></h5>
<button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<pre class="response-box" id="metricModalBody"></pre>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API = 'https://custom-metric-playground.vercel.app';
let metrics = [];
let editing = null;
let evalMetricCache = null;

function alertMsg(msg,type='info'){
const d=document.createElement('div');
d.className=`alert alert-${type}`;
d.textContent=msg;
alertContainer.appendChild(d);
setTimeout(()=>d.remove(),5000);
}

async function api(url,opt={}){
const r=await fetch(API+url,{
headers:{'Content-Type':'application/json'},
...opt
});
if(!r.ok) throw new Error(await r.text());
return r.json();
}

/* load metrics */
async function loadMetrics(){
metrics = await api('/v1/metrics/?limit=100');
metricsList.innerHTML = metrics.map(m=>`
<div class="metric-item" onclick="showMetricDetails('${m.name}')">
<strong>${m.name}</strong>
<div class="text-secondary small">${m.description||'no description'}</div>
<div class="metric-actions">
<button disabled class="btn btn-sm btn-outline-secondary" onclick="event.stopPropagation();editMetric('${m.name}')">edit</button>
<button disabled class="btn btn-sm btn-danger" onclick="event.stopPropagation();deleteMetric('${m.name}')">delete</button>
</div>
</div>
`).join('');

evalMetricSelect.innerHTML =
'<option value="">select metric</option>' +
metrics.map(m=>`<option value="${m.name}">${m.name}</option>`).join('');
}

function showMetricDetails(name){
const m=metrics.find(x=>x.name===name);
metricModalTitle.textContent=m.name;
metricModalBody.textContent=JSON.stringify(m,null,2);
new bootstrap.Modal(metricModal).show();
}

/* dynamic fields */
function addInputField(v=''){
inputFieldsContainer.insertAdjacentHTML('beforeend',
`<input class="form-control mb-1 input-field" value="${v}" required>`);
}

function addOutputField(k='',t='number'){
outputSchemaContainer.insertAdjacentHTML('beforeend',
`<div class="d-flex gap-2 mb-1">
<input class="form-control output-key" value="${k}" required>
<select class="form-select output-type">
<option ${t==='number'?'selected':''}>number</option>
<option ${t==='string'?'selected':''}>string</option>
<option ${t==='boolean'?'selected':''}>boolean</option>
</select>
</div>`);
}

/* create update */
createMetricForm.onsubmit=async e=>{
e.preventDefault();
saveMetricBtn.disabled=true;
saveMetricBtn.innerHTML='Saving <span class="loader"></span>';

try{
const input_fields=[...document.querySelectorAll('.input-field')].map(i=>i.value);
const output_schema={};
document.querySelectorAll('.output-key').forEach((k,i)=>{
output_schema[k.value]=document.querySelectorAll('.output-type')[i].value;
});

const payload={
name:metricName.value,
description:metricDescription.value||null,
prompt_template:promptTemplate.value,
input_fields,
output_schema
};

if(editing){
await api(`/v1/metrics/${editing}`,{method:'PATCH',body:JSON.stringify(payload)});
alertMsg('Metric updated','success');
}else{
await api('/v1/metrics/',{method:'POST',body:JSON.stringify(payload)});
alertMsg('Metric created','success');
}

editing=null;
createMetricForm.reset();
inputFieldsContainer.innerHTML='';
outputSchemaContainer.innerHTML='';
addInputField();
addOutputField();
loadMetrics();
}catch(err){
alertMsg(err.message,'danger');
}finally{
saveMetricBtn.disabled=false;
saveMetricBtn.textContent='Save Metric';
}
};

/* edit delete */
function editMetric(name){
const m=metrics.find(x=>x.name===name);
editing=name;
metricName.value=m.name;
metricDescription.value=m.description||'';
promptTemplate.value=m.prompt_template;
inputFieldsContainer.innerHTML='';
m.input_fields.forEach(addInputField);
outputSchemaContainer.innerHTML='';
Object.entries(m.output_schema).forEach(([k,v])=>addOutputField(k,v));
document.querySelector('[href="#createTab"]').click();
}

async function deleteMetric(name){
if(!confirm('Confirm delete metric '+name+'?')) return;
try{
await api(`/v1/metrics/${name}`,{method:'DELETE'});
alertMsg('Metric deleted','success');
loadMetrics();
}catch(err){
alertMsg(err.message,'danger');
}
}

/* evaluate */
evalMetricSelect.onchange=async()=>{
evalInputsContainer.innerHTML='';
evalMetricCache=null;
if(!evalMetricSelect.value) return;
evalMetricCache=await api(`/v1/metrics/${evalMetricSelect.value}`);
evalInputsContainer.innerHTML=evalMetricCache.input_fields.map(f=>`
<div class="mb-2">
<label class="form-label">${f}</label>
<textarea class="form-control eval-input" data-f="${f}" required></textarea>
</div>
`).join('');
};

evaluateForm.onsubmit=async e=>{
e.preventDefault();
evaluateBtn.disabled=true;
evaluateBtn.innerHTML='Evaluating <span class="loader"></span>';
try{
const inputs={};
document.querySelectorAll('.eval-input').forEach(i=>inputs[i.dataset.f]=i.value);

const res=await api(`/v1/metrics/${evalMetricCache.name}/evaluate`,{
method:'POST',
body:JSON.stringify({
inputs,
provider:evalProvider.value,
model:evalModel.value
})
});

evalResult.innerHTML='';
Object.entries(res).forEach(([k,v])=>{
const box=document.createElement('div');
box.className='response-box';
box.textContent=`${k}:\n${JSON.stringify(v,null,2)}`;
evalResult.appendChild(box);
});
evalResultContainer.style.display='block';
}catch(err){
alertMsg(err.message,'danger');
}finally{
evaluateBtn.disabled=true;
evaluateBtn.textContent='Evaluate';
}
};

/* init */
addInputField();
addOutputField();
loadMetrics();
</script>

</body>
</html>
